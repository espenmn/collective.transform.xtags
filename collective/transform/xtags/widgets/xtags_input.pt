
<tal:widget tal:define="id string:${view/id}">
<div class="previewbuttons">
  <p class="button-field context fa fa-eye" id="mdpreview"> Update Preview</p>
</div>
<div class="flexbox">
<textarea  class="xtags-textarea"
           type="textarea"
           role="xtags"
           tal:attributes="id id;
           name view/name;
           value view/value;
           disabled view/disabled;
           alt view/alt;
           accesskey view/accesskey;
           onselect view/onselect;"
           tal:content="view/value"/>
<div id="result" class="fullwidth"> </div>
</div>

<div id="result">${view/render_xtags}</div>
<script>
$( "#mdpreview" ).click(function() {
  var md = $('#${id}').selection();
  len = md.length;
  if (len < 3)  {
    var md = $('#${id}').val();
    var caretPos = $('#${id}')[0].selectionStart;
    var md = md.slice(0, caretPos) + '<a id="you_are_here" name="you_are_here">></a>' + md.slice(caretPos);
  }
  $.post("render_from_xtags", { tagged_text: md}, function( data ) {
    $( "#result" ).html( data );
  });
});
</script>
<script>
$(document).on('keypress', '#${id}', function(e) {
        if ( e.keyCode == 13 ) {  // detect the enter key
            $('#mdpreview').click(); // fire a sample click,  you can do anything
            $("#you_are_here").get(0).scrollIntoView();
            var y = $('#result').scrollTop();
            $('#result').scrollTop(y-300);
    	}
});
</script>
</tal:widget>
